{% extends "prediction/base.html" %}
{% load static %}
{% block javascript %}
    <script type="text/javascript" src="{% static 'prediction/js/echarts.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'prediction/js/draw_charts.js' %}"></script>
    <script type="text/javascript">
        var stock_data = null;
        var recent_data = null;
        var stock_code = null;
        var predict_data = null;
        var stock_name = null;
        var indexs = null;
        $(document).ready(function(){
            $.ajaxSetup({
                data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });

            $('#myform').submit(function(){
                var code = $("#id_code").val();
                $.ajax({
                    type:"POST",
                    data: {code:code},
                    url: "{% url 'prediction:pred' %}",
                    cache: false,
                    dataType: "json",
                    beforeSend: function(){
                        //$('#myModel').modal({backdrop:static}); //设置模态框之外点击无效
                        $('#myModel').modal('show');      // 弹出模态框
                    },
                    success: function (res) {
                        $('#myModel').modal('hide');       // 隐藏模态框
                        if (res.data){
                            stock_data = JSON.parse(res.data); 
                            recent_data = stock_data.recent_data;
                            predict_data = stock_data.predict_data;
                            stock_code = stock_data.stock_code;
                            stock_name = stock_data.stock_name;
                        }
                       
                        if(recent_data != null && predict_data != null && stock_code != null && stock_name != null){
                           draw_chart();
                        }

                        if(indexs != null){
                            draw_radar();
                        }

                    },
                    error: function (msg) {
                        alert(JSON.stringify(msg));
                    }
                });
                return false;    
            });
        });
    </script>
{% endblock %}
{% block nav %}
<li class="active">
    <a href="/boards/" class="btn btn-success" style='float:right;margin:10px'>
        返回
    </a>
</li>
{% endblock nav %}
{% block content %}
<div class="content">
    <img alt="" height="180" src="{% static 'prediction/img/mediadem_polls_LauraLalonde.gif' %}" width="500"/>
    <div class="form-group col-sm-6 col-sm-offset-1">
        <h2 align="center">
            获取您的预测！
        </h2>
        <form align="left"  id="myform">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-success" >查询</button>
        </form>
    </div> 
</div>
<center>
    <!-- 为ECharts准备一个具备大小（宽高）的容器 -->
    <div style="width:100%;height:400px;margin-top:50px;">
        <div id="hist_futu" style="float:left;width: 100%;height:450px;"></div>
        <div id="radar" style="width:50%;height:600px;"></div>
    </div>
</center>
<div class="modal fade" id="myModel" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:400px;height:80px;margin-top:220px;margin-left:130px">
            <div class="modal-header" style="text-align:left;font-size:small;height:8px;margin-bottom:10px">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top:-15px"><span
                    aria-hidden="true">×</span></button>
                <p class="modal-title" style="margin-top:-10px;color:dodgerblue">人工智能深度机器学习</p>
            </div>
            <div class="modal-body" style="text-align: center;font-size:16px;height: 18px;color:chocolate">
                <p style="margin-top:-15px">正在训练数据中，请耐心等待......</p>
            </div>
            <div class="modal-footer">
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock content %}
